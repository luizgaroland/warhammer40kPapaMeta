2025-08-12 01:28:26,249 - src.database - INFO - [2m2025-08-12 01:28:26[0m [[32m[1minfo     [0m] [1mTesting database connection...[0m [[34m[1msrc.database[0m] 
2025-08-12 01:28:26,279 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-08-12 01:28:26,280 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-08-12 01:28:26,281 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-08-12 01:28:26,281 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-08-12 01:28:26,282 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-08-12 01:28:26,282 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-08-12 01:28:26,283 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-12 01:28:26,283 - sqlalchemy.engine.Engine - INFO - SELECT version()
2025-08-12 01:28:26,283 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] {}
2025-08-12 01:28:26,283 - src.database - INFO - [2m2025-08-12 01:28:26[0m [[32m[1minfo     [0m] [1mdatabase_connected            [0m [[34m[1msrc.database[0m] [36mpostgres_version[0m=[35mPostgreSQL 15.13 on x86_64-pc-linux-musl, compiled by gcc (Alpine 14.2.0) 14.2.0, 64-bit[0m
2025-08-12 01:28:26,284 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-12 01:28:26,288 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-12 01:28:26,289 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-08-12 01:28:26,289 - sqlalchemy.engine.Engine - INFO - [generated in 0.00063s] {}
2025-08-12 01:28:26,290 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-12 01:28:26,290 - src.database - INFO - [2m2025-08-12 01:28:26[0m [[32m[1minfo     [0m] [1mâœ“ Database connection successful[0m [[34m[1msrc.database[0m] 
2025-08-12 01:28:26,294 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-12 01:28:26,294 - sqlalchemy.engine.Engine - INFO - 
                    SELECT table_name 
                    FROM information_schema.tables 
                    WHERE table_schema = 'public'
                
2025-08-12 01:28:26,294 - sqlalchemy.engine.Engine - INFO - [generated in 0.00041s] {}
2025-08-12 01:28:26,298 - src.database - INFO - [2m2025-08-12 01:28:26[0m [[32m[1minfo     [0m] [1mschema_verification_complete  [0m [[34m[1msrc.database[0m] [36mmissing[0m=[35m['warhammer_major_versions', 'warhammer_updates', 'version_snapshots', 'factions', 'faction_versions', 'detachments', 'enhancements', 'units', 'unit_versions', 'unit_enhancement_compatibility', 'wargear', 'unit_wargear_options', 'wahapedia_scrape_state', 'source_mappings', 'scrape_logs', 'redis_messages'][0m [36mtables_expected[0m=[35m16[0m [36mtables_found[0m=[35m0[0m
2025-08-12 01:28:26,298 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-12 01:28:26,298 - src.database - WARNING - [2m2025-08-12 01:28:26[0m [[33m[1mwarning  [0m] [1mMissing tables: ['warhammer_major_versions', 'warhammer_updates', 'version_snapshots', 'factions', 'faction_versions', 'detachments', 'enhancements', 'units', 'unit_versions', 'unit_enhancement_compatibility', 'wargear', 'unit_wargear_options', 'wahapedia_scrape_state', 'source_mappings', 'scrape_logs', 'redis_messages'][0m [[34m[1msrc.database[0m] 
2025-08-12 01:28:26,298 - src.database - INFO - [2m2025-08-12 01:28:26[0m [[32m[1minfo     [0m] [1mRun 'make init-db' to create the schema[0m [[34m[1msrc.database[0m] 
2025-08-12 01:28:26,299 - src.redis_client - INFO - [2m2025-08-12 01:28:26[0m [[32m[1minfo     [0m] [1mTesting Redis connection...   [0m [[34m[1msrc.redis_client[0m] 
2025-08-12 01:28:26,304 - src.redis_client - INFO - [2m2025-08-12 01:28:26[0m [[32m[1minfo     [0m] [1mredis_connected               [0m [[34m[1msrc.redis_client[0m] [36mconnected_clients[0m=[35m2[0m [36mredis_version[0m=[35m7.4.5[0m [36mused_memory[0m=[35m1.09M[0m
2025-08-12 01:28:26,304 - src.redis_client - INFO - [2m2025-08-12 01:28:26[0m [[32m[1minfo     [0m] [1mâœ“ Redis connection successful [0m [[34m[1msrc.redis_client[0m] 
2025-08-12 01:28:26,304 - src.redis_client - INFO - [2m2025-08-12 01:28:26[0m [[32m[1minfo     [0m] [1msubscribed_to_channel         [0m [[34m[1msrc.redis_client[0m] [36mchannel[0m=[35mtest:pubsub[0m
2025-08-12 01:28:27,308 - src.redis_client - INFO - [2m2025-08-12 01:28:27[0m [[32m[1minfo     [0m] [1mâœ“ Redis pub/sub test successful[0m [[34m[1msrc.redis_client[0m] 
2025-08-12 01:28:27,309 - src.redis_client - INFO - [2m2025-08-12 01:28:27[0m [[32m[1minfo     [0m] [1mâœ“ Redis pub/sub working       [0m [[34m[1msrc.redis_client[0m] 
2025-08-12 01:30:03,774 - src.database - INFO - [2m2025-08-12 01:30:03[0m [[32m[1minfo     [0m] [1mTesting database connection...[0m [[34m[1msrc.database[0m] 
2025-08-12 01:30:03,799 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-08-12 01:30:03,800 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-08-12 01:30:03,800 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-08-12 01:30:03,800 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-08-12 01:30:03,801 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-08-12 01:30:03,801 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-08-12 01:30:03,801 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-12 01:30:03,802 - sqlalchemy.engine.Engine - INFO - SELECT version()
2025-08-12 01:30:03,802 - sqlalchemy.engine.Engine - INFO - [generated in 0.00030s] {}
2025-08-12 01:30:03,802 - src.database - INFO - [2m2025-08-12 01:30:03[0m [[32m[1minfo     [0m] [1mdatabase_connected            [0m [[34m[1msrc.database[0m] [36mpostgres_version[0m=[35mPostgreSQL 15.13 on x86_64-pc-linux-musl, compiled by gcc (Alpine 14.2.0) 14.2.0, 64-bit[0m
2025-08-12 01:30:03,802 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-12 01:30:03,806 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-12 01:30:03,806 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-08-12 01:30:03,806 - sqlalchemy.engine.Engine - INFO - [generated in 0.00036s] {}
2025-08-12 01:30:03,806 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-12 01:30:03,807 - src.database - INFO - [2m2025-08-12 01:30:03[0m [[32m[1minfo     [0m] [1mâœ“ Database connection successful[0m [[34m[1msrc.database[0m] 
2025-08-12 01:30:03,810 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-12 01:30:03,810 - sqlalchemy.engine.Engine - INFO - 
                    SELECT table_name 
                    FROM information_schema.tables 
                    WHERE table_schema = 'public'
                
2025-08-12 01:30:03,810 - sqlalchemy.engine.Engine - INFO - [generated in 0.00034s] {}
2025-08-12 01:30:03,814 - src.database - INFO - [2m2025-08-12 01:30:03[0m [[32m[1minfo     [0m] [1mschema_verification_complete  [0m [[34m[1msrc.database[0m] [36mmissing[0m=[35m[][0m [36mtables_expected[0m=[35m16[0m [36mtables_found[0m=[35m16[0m
2025-08-12 01:30:03,814 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-12 01:30:03,814 - src.database - INFO - [2m2025-08-12 01:30:03[0m [[32m[1minfo     [0m] [1mâœ“ Database schema verified    [0m [[34m[1msrc.database[0m] 
2025-08-12 01:30:03,818 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-12 01:30:03,818 - sqlalchemy.engine.Engine - INFO - 
                    INSERT INTO scrape_logs 
                    (source, scrape_type, status, started_at, items_processed)
                    VALUES 
                    (%(source)s, %(scrape_type)s, %(status)s, %(started_at)s, %(items_processed)s)
                    RETURNING id
                
2025-08-12 01:30:03,818 - sqlalchemy.engine.Engine - INFO - [generated in 0.00035s] {'source': 'test', 'scrape_type': 'connection_test', 'status': 'completed', 'started_at': datetime.datetime(2025, 8, 12, 1, 30, 3, 818152), 'items_processed': 0}
2025-08-12 01:30:03,820 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-12 01:30:03,823 - src.database - INFO - [2m2025-08-12 01:30:03[0m [[32m[1minfo     [0m] [1mdatabase_write_test_successful[0m [[34m[1msrc.database[0m] [36mtest_id[0m=[35m1[0m
2025-08-12 01:30:03,823 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-12 01:30:03,824 - sqlalchemy.engine.Engine - INFO - DELETE FROM scrape_logs WHERE id = %(id)s
2025-08-12 01:30:03,824 - sqlalchemy.engine.Engine - INFO - [generated in 0.00056s] {'id': 1}
2025-08-12 01:30:03,825 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-08-12 01:30:03,826 - src.database - INFO - [2m2025-08-12 01:30:03[0m [[32m[1minfo     [0m] [1mâœ“ Database write permissions confirmed[0m [[34m[1msrc.database[0m] 
2025-08-12 01:30:03,830 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-08-12 01:30:03,830 - sqlalchemy.engine.Engine - INFO - 
                    SELECT 
                        vs.id as version_snapshot_id,
                        wmv.version_number as major_version,
                        wu.version_code as update_code,
                        wu.name as update_name,
                        vs.effective_date
                    FROM version_snapshots vs
                    JOIN warhammer_major_versions wmv ON vs.major_version_id = wmv.id
                    LEFT JOIN warhammer_updates wu ON vs.update_id = wu.id
                    WHERE vs.is_current = TRUE
                    LIMIT 1
                
2025-08-12 01:30:03,830 - sqlalchemy.engine.Engine - INFO - [generated in 0.00055s] {}
2025-08-12 01:30:03,833 - sqlalchemy.engine.Engine - INFO - ROLLBACK
2025-08-12 01:30:03,833 - src.database - WARNING - [2m2025-08-12 01:30:03[0m [[33m[1mwarning  [0m] [1mNo current version set in database[0m [[34m[1msrc.database[0m] 
2025-08-12 01:30:03,833 - src.redis_client - INFO - [2m2025-08-12 01:30:03[0m [[32m[1minfo     [0m] [1mTesting Redis connection...   [0m [[34m[1msrc.redis_client[0m] 
2025-08-12 01:30:03,838 - src.redis_client - INFO - [2m2025-08-12 01:30:03[0m [[32m[1minfo     [0m] [1mredis_connected               [0m [[34m[1msrc.redis_client[0m] [36mconnected_clients[0m=[35m2[0m [36mredis_version[0m=[35m7.4.5[0m [36mused_memory[0m=[35m1.23M[0m
2025-08-12 01:30:03,839 - src.redis_client - INFO - [2m2025-08-12 01:30:03[0m [[32m[1minfo     [0m] [1mâœ“ Redis connection successful [0m [[34m[1msrc.redis_client[0m] 
2025-08-12 01:30:03,839 - src.redis_client - INFO - [2m2025-08-12 01:30:03[0m [[32m[1minfo     [0m] [1msubscribed_to_channel         [0m [[34m[1msrc.redis_client[0m] [36mchannel[0m=[35mtest:pubsub[0m
2025-08-12 01:30:04,842 - src.redis_client - INFO - [2m2025-08-12 01:30:04[0m [[32m[1minfo     [0m] [1mâœ“ Redis pub/sub test successful[0m [[34m[1msrc.redis_client[0m] 
2025-08-12 01:30:04,843 - src.redis_client - INFO - [2m2025-08-12 01:30:04[0m [[32m[1minfo     [0m] [1mâœ“ Redis pub/sub working       [0m [[34m[1msrc.redis_client[0m] 
2025-08-12 01:30:05,845 - src.database - INFO - [2m2025-08-12 01:30:05[0m [[32m[1minfo     [0m] [1mdatabase_connections_closed   [0m [[34m[1msrc.database[0m] 
2025-08-12 01:30:05,846 - src.redis_client - ERROR - [2m2025-08-12 01:30:05[0m [[31m[1merror    [0m] [1msubscriber_thread_error       [0m [[34m[1msrc.redis_client[0m] [36merror[0m=[35mI/O operation on closed file.[0m
2025-08-12 01:30:05,846 - src.redis_client - INFO - [2m2025-08-12 01:30:05[0m [[32m[1minfo     [0m] [1mredis_connections_closed      [0m [[34m[1msrc.redis_client[0m] 
